<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="CheckIfNuSealDirectlyReferenced"
          BeforeTargets="BeforeCompile">

    <PropertyGroup>
      <IsNuSealPackageReferenced>@(PackageReference->WithMetadataValue('Identity', 'NuSeal')->'%(Identity)'->Count())</IsNuSealPackageReferenced>
    </PropertyGroup>
    
  </Target>

  <Target Name="InjectNuSealProtectedAttribute"
          BeforeTargets="BeforeCompile"
          DependsOnTargets="CheckIfNuSealDirectlyReferenced"
          Condition="$(IsNuSealPackageReferenced) != 0">

    <ItemGroup>
      <AssemblyAttribute Include="NuSeal.NuSealProtectedAttribute" />
    </ItemGroup>

  </Target>

  <Target Name="NuSealLicenseValidation"
          AfterTargets="AfterBuild"
          Condition="'$(OutputType)' == 'Exe' Or '$(OutputType)' == 'WinExe' Or '$(MSBuildProjectSdk)' == 'Microsoft.NET.Sdk.Web'">

    <NuSeal.LicenseValidationTask
      MainAssemblyPath="$(TargetPath)" />

  </Target>

</Project>
