<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="NuSealCheckDirectReference"
          BeforeTargets="BeforeCompile">

    <PropertyGroup>
      <IsNuSealPackageReferenced>@(PackageReference->WithMetadataValue('Identity', 'NuSeal')->'%(Identity)'->Count())</IsNuSealPackageReferenced>
    </PropertyGroup>
    
  </Target>

  <Target Name="NuSealInjectProtectedAttribute"
          BeforeTargets="BeforeCompile"
          DependsOnTargets="NuSealCheckDirectReference"
          Condition="$(IsNuSealPackageReferenced) != 0">

    <ItemGroup>
      <AssemblyAttribute Include="NuSeal.NuSealProtectedAttribute" />
    </ItemGroup>

  </Target>

  <Target Name="NuSealInjectValidationBehaviorAttribute"
          BeforeTargets="BeforeCompile"
          DependsOnTargets="NuSealCheckDirectReference"
          Condition="$(IsNuSealPackageReferenced) != 0 And '$(NuSealValidationBehavior)' != ''">

    <ItemGroup>
      <AssemblyAttribute Include="NuSeal.NuSealValidationBehaviorAttribute">
        <_Parameter1>$(NuSealValidationBehavior)</_Parameter1>
      </AssemblyAttribute>
    </ItemGroup>

  </Target>

  <Target Name="NuSealLicenseValidation"
          AfterTargets="AfterBuild"
          Condition="'$(OutputType)' == 'Exe' Or '$(OutputType)' == 'WinExe' Or '$(MSBuildProjectSdk)' == 'Microsoft.NET.Sdk.Web'">

    <NuSeal.LicenseValidationTask
      MainAssemblyPath="$(TargetPath)" />

  </Target>

</Project>
