<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="NuSealPrepareAssetsForConsumer"
          BeforeTargets="Build">

    <NuSeal.GenerateConsumerAssetsTask
        NuSealAssetsPath="$(MSBuildThisFileDirectory)"
        NuSealVersion="@(PackageReference->WithMetadataValue('Identity', 'NuSeal')->'%(Version)')"
        ConsumerOutputPath="$(OutputPath)"
        ConsumerPackageId="$(PackageId)"
        ConsumerAssemblyName="$(AssemblyName)"
        ConsumerPems="@(NuSealPem)"
        ConsumerPropsFile="$(NuSealIncludePropsFile)"
        ConsumerTargetsFile="$(NuSealIncludeTargetsFile)"
        ValidationMode ="$(NuSealValidationMode)"
        ValidationScope ="$(NuSealValidationScope)"
        />

    <ItemGroup Label="Package build assets">
      <None Include="$(OutputPath)\$(PackageId).props" Pack="true" PackagePath="build\$(PackageId).props" Visible="false"/>
      <None Include="$(OutputPath)\$(PackageId).targets" Pack="true" PackagePath="build\$(PackageId).targets" Visible="false"/>
    </ItemGroup>

    <ItemGroup Label="Package buildTransitive assets" Condition="'$(NuSealValidationScope)' == 'Transitive'">
      <None Include="$(OutputPath)\$(PackageId).props" Pack="true" PackagePath="buildTransitive\$(PackageId).props" Visible="false"/>
      <None Include="$(OutputPath)\$(PackageId).targets" Pack="true" PackagePath="buildTransitive\$(PackageId).targets" Visible="false"/>
    </ItemGroup>
    
  </Target>
  
</Project>
