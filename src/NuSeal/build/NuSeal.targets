<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="NuSealPrepareAssetsForConsumer"
          BeforeTargets="Build">

    <PropertyGroup>
      <NuSealOutputPath Condition="!Exists('$(NuSealOutputPath)')">$(OutputPath)</NuSealOutputPath>
    </PropertyGroup>

    <NuSeal.GenerateConsumerAssetsTask
        NuSealAssetsPath="$(MSBuildThisFileDirectory)"
        NuSealVersion="@(PackageReference->WithMetadataValue('Identity', 'NuSeal')->'%(Version)')"
        ConsumerOutputPath="$(NuSealOutputPath)"
        ConsumerPackageId="$(PackageId)"
        ConsumerAssemblyName="$(AssemblyName)"
        ConsumerPems="@(NuSealPem)"
        ConsumerPropsFile="$(NuSealIncludePropsFile)"
        ConsumerTargetsFile="$(NuSealIncludeTargetsFile)"
        ValidationMode ="$(NuSealValidationMode)"
        ValidationScope ="$(NuSealValidationScope)"
        />

    <ItemGroup Condition="'$(NuSealPackAssets)' != 'disable'">
      <None Include="$(NuSealOutputPath)\$(PackageId).props" Pack="true" PackagePath="build\$(PackageId).props" Visible="false"/>
      <None Include="$(NuSealOutputPath)\$(PackageId).targets" Pack="true" PackagePath="build\$(PackageId).targets" Visible="false"/>
    </ItemGroup>

    <ItemGroup Condition="'$(NuSealPackAssets)' != 'disable' AND '$(NuSealValidationScope)' == 'Transitive'">
      <None Include="$(NuSealOutputPath)\$(PackageId).props" Pack="true" PackagePath="buildTransitive\$(PackageId).props" Visible="false"/>
      <None Include="$(NuSealOutputPath)\$(PackageId).targets" Pack="true" PackagePath="buildTransitive\$(PackageId).targets" Visible="false"/>
    </ItemGroup>
    
  </Target>
  
</Project>
